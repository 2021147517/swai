<!DOCTYPE html>
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <link rel="shortcut icon" href="images/favicon.png" type="">

  <title> MakeItCount AI </title>

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

  <!-- fonts style -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!--owl slider stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

  <!-- font awesome style -->
  <link href="css/font-awesome.min.css" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  <!-- responsive style -->
  <link href="css/responsive.css" rel="stylesheet" />

</head>

<body>

  <div class="hero_area">

    <div class="hero_bg_box">
      <div class="bg_img_box">
        <img src="images/hero-bg.png" alt="">
      </div>
    </div>

    <!-- header section strats -->
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <span>
              MakeItCount<sup>AI</sup>
            </span>
          </a>
        </nav>
      </div>
    </header>
    <!-- end header section -->
    <!-- slider section -->
    <section class="slider_section ">
      <div id="customCarousel1" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="container ">
              <div class="row">
                <div class="col-md-6 ">
                  <div class="detail-box">
                    <h1>
                      MakeItCount<sup>AI</sup>
                    </h1>
                    <p>
                      AI 스케줄러, 쉽고 똑똑하게 하루를 관리하세요<br>
                      말 한마디로 일정 등록부터 최적 배치까지, AI가 알아서 처리합니다<br>
                      미루기 방지 알림과 자동 재배치로 시간 낭비 없이 목표를 달성하세요
                    </p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="img-box">
                    <img src="images/flim-Photoroom.png" alt="">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </section>
    <!-- end slider section -->
  </div>

  <!-- demo section -->
  <section class="demo_section layout_padding">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>
          직접 <span>경험해보세요</span>
        </h2>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="calendar-container">
            <div class="calendar-header">
              <button class="btn btn-link" id="prevMonth"><i class="fa fa-chevron-left"></i></button>
              <h3 id="currentMonth">2024년 3월</h3>
              <button class="btn btn-link" id="nextMonth"><i class="fa fa-chevron-right"></i></button>
            </div>
            <div class="calendar-body">
              <div class="calendar-weekdays">
                <div>일</div>
                <div>월</div>
                <div>화</div>
                <div>수</div>
                <div>목</div>
                <div>금</div>
                <div>토</div>
              </div>
              <div class="calendar-grid" id="calendarGrid">
                <!-- 달력 그리드는 JavaScript로 동적 생성됩니다 -->
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="event-list-container">
            <div class="list-container-header">
              <h4 id="selectedDateEventsTitle">오늘의 일정</h4>
              <div class="button-group">
                <button class="btn btn-primary" id="addNewEventBtn">추가</button>
              </div>
            </div>
            <div id="currentDayEvents">
              <!-- 선택된 날짜의 일정이 여기에 표시됩니다 -->
            </div>
          </div>
          <div class="todo-list-container">
            <div class="list-container-header">
              <h4>언젠가</h4>
              <div class="button-group">
                <button class="btn btn-secondary" id="rebalanceScheduleBtn">
                  리밸런싱
                </button>
                <button class="btn btn-primary" id="addNewTodoBtn">추가</button>
              </div>
            </div>
            <div id="todoList">
              <!-- 할 일 목록이 여기에 표시됩니다 -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 새 일정 추가 모달 -->
  <div class="modal fade" id="addEventModal" tabindex="-1" role="dialog" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addEventModalLabel">새 일정 추가</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="eventForm">
            <div class="form-group">
              <label for="eventTitle">제목</label>
              <input type="text" class="form-control" id="eventTitle" required>
            </div>
            <div class="form-group">
              <label for="eventDate">날짜</label>
              <input type="date" class="form-control" id="eventDate" required>
            </div>
            <div class="form-group">
              <label for="eventTime">시간</label>
              <div class="time-input-container">
                <div class="time-input-group">
                  <select class="form-control" id="eventStartAmPm">
                    <option value="AM">오전</option>
                    <option value="PM">오후</option>
                  </select>
                  <select class="form-control" id="eventStartHour">
                    <option value="12">12</option>
                    <option value="01">1</option>
                    <option value="02">2</option>
                    <option value="03">3</option>
                    <option value="04">4</option>
                    <option value="05">5</option>
                    <option value="06">6</option>
                    <option value="07">7</option>
                    <option value="08">8</option>
                    <option value="09">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                  </select>
                  <span class="time-separator">:</span>
                  <select class="form-control" id="eventStartMinute">
                    <option value="00">00</option>
                    <option value="15">15</option>
                    <option value="30">30</option>
                    <option value="45">45</option>
                  </select>
                </div>
                <span class="time-separator">~</span>
                <div class="time-input-group">
                  <select class="form-control" id="eventEndAmPm">
                    <option value="AM">오전</option>
                    <option value="PM">오후</option>
                  </select>
                  <select class="form-control" id="eventEndHour">
                    <option value="01">1</option>
                    <option value="02">2</option>
                    <option value="03">3</option>
                    <option value="04">4</option>
                    <option value="05">5</option>
                    <option value="06">6</option>
                    <option value="07">7</option>
                    <option value="08">8</option>
                    <option value="09">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>

                  </select>
                  <span class="time-separator">:</span>
                  <select class="form-control" id="eventEndMinute">
                    <option value="00">00</option>
                    <option value="15">15</option>
                    <option value="30">30</option>
                    <option value="45">45</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="eventDescription">메모 (선택 사항)</label>
              <textarea class="form-control" id="eventDescription" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">저장</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 새 할 일 추가 모달 -->
  <div class="modal fade" id="addTodoModal" tabindex="-1" role="dialog" aria-labelledby="addTodoModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addTodoModalLabel">새 할 일 추가</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="todoForm">
            <div class="form-group">
              <label for="todoTitle">제목</label>
              <input type="text" class="form-control" id="todoTitle" required>
            </div>
            <div class="form-group">
              <label for="todoDueDate">마감 기한</label>
              <input type="date" class="form-control" id="todoDueDate" required>
            </div>
            <div class="form-group">
              <label for="todoPriority">우선순위</label>
              <select class="form-control" id="todoPriority" required>
                <option value="very-high">매우 높음</option>
                <option value="high">높음</option>
                <option value="medium">중간</option>
                <option value="low">낮음</option>
                <option value="very-low">매우 낮음</option>
              </select>
            </div>
            <div class="form-group">
              <label for="todoDuration">예상 소요 시간 (분)</label>
              <input type="number" class="form-control" id="todoDuration" min="1" required style="-moz-appearance: textfield;">
            </div>
            <div class="form-group">
              <label for="todoDescription">메모 (선택 사항)</label>
              <textarea class="form-control" id="todoDescription" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">저장</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- service section -->

  <section class="service_section layout_padding">
    <div class="service_container">
      <div class="container ">
        <div class="heading_container heading_center">
          <h2>
            주요 <span>기능</span>
          </h2>
        </div>
        <div class="row">
          <div class="col-md-4 ">
            <div class="box ">
              <div class="img-box">
                <img src="images/genim1.png" alt="">
              </div>
              <div class="detail-box">
                <h5>
                  자연어 일정 입력
                </h5>
                <p>
                  복잡한 일정 입력 대신, 말하듯 쓰면 AI가 캘린더에 딱 맞게 배치
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4 ">
            <div class="box ">
              <div class="img-box">
                <img src="images/genim2.png" alt="">
              </div>
              <div class="detail-box">
                <h5>
                  AI 기반 최적 스케줄 추천
                </h5>
                <p>
                  사용자의 빈 시간·집중 패턴·우선순위를 한 번에 분석. 가장 효율적인 타임블록을 자동으로 제안
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4 ">
            <div class="box ">
              <div class="img-box">
                <img src="images/genim3.png" alt="">
              </div>
              <div class="detail-box">
                <h5>
                  미루기 방지 알림 & 자동 재배치
                </h5>
                <p>
                  일정을 미루면 푸시 알림 <br>푸시 알림 후에도 미루면 재배치·경고 메시지 발송
                </p>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>
    </div>
  </section>


  
  <!-- end service section -->


  <!-- about section -->

  <section class="about_section layout_padding">
    <div class="service_container">
      <div class="container ">
        <div class="heading_container heading_center">
          <h2>
            왜 <span>MakeItCount<sup>AI</sup></span>인가?
          </h2>
        </div>
        <div class="row">
          <div class="col-md-4 ">
            <div class="box ">
              <div class="img-box">
                <img src="images/goog.png" alt="">
              </div>
              <div class="detail-box">
                <h5>
                  구글 캘린더 연동
                </h5>
                <p>
                  클릭 한 번으로 구글 캘린더와 실시간 자동 동기화
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4 ">
            <div class="box ">
              <div class="img-box">
                <img src="images/sche.png" alt="">
              </div>
              <div class="detail-box">
                <h5>
                  강의 시간표 가져오기
                </h5>
                <p>
                  클릭 한 번으로 학교 시간표 불러오기
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4 ">
            <div class="box ">
              <div class="img-box">
                <img src="images/reba.png" alt="">
              </div>
              <div class="detail-box">
                <h5>
                  실시간 우선순위 리밸런싱
                </h5>
                <p>
                  예기치 않은 일정 변경이 생기면 즉시 남은 일정 전체를 재분석·재배치해 혼란 없이 스케줄을 유지
                </p>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>
    </div>
  </section>

  <!-- end about section -->

  <!-- FAQ section -->

  <section class="faq_section layout_padding">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>
          FAQ
        </h2>
      </div>
      <div class="faq_container">
        <div class="box">
          <div class="detail-box">
            <h5>
              Q1. AI 추천 스케줄링은 어떻게 동작하나요?
            </h5>
            <p>
              사용자가 입력한 마감 기한, 예상 소요 시간, 우선 순위 등의 데이터를 종합 분석해 최적의 타임블록을 배치합니다.
            </p>
          </div>
        </div>
        <div class="box">
          <div class="detail-box">
            <h5>
              Q2. 모든 학교 시간표를 가져올 수 있나요?
            </h5>
            <p>
              개발 초기에는 연세대학교(서울) 시간표만 연동할 예정입니다.
            </p>
          </div>
        </div>
        <div class="box">
          <div class="detail-box">
            <h5>
              Q3. 다중 디바이스 간 실시간 동기화가 되나요?
            </h5>
            <p>
              네. 웹·모바일·데스크탑 앱 버전 모두 동일 계정으로 로그인 시 1분 이내에 실시간 동기화됩니다.
            </p>
          </div>
        </div>
        <div class="box">
          <div class="detail-box">
            <h5>
              Q4. 언제 정식 출시되나요?
            </h5>
            <p>
              2025년 7월 초를 목표로 하고 있습니다. 사전등록하시면 출시 알림을 가장 먼저 받아보실 수 있습니다.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- end faq section -->

  <!-- info section -->

  <section class="info_section layout_padding2">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-lg-3 info_col">
          <div class="info_contact">
            <h4>
              Address
            </h4>
            <div class="contact_link_box">
              <a href="">
                <i class="fa fa-map-marker" aria-hidden="true"></i>
                <span>
                  
                </span>
              </a>
              <a href="">
                <i class="fa fa-phone" aria-hidden="true"></i>
                <span>
                  Call +82 01072663324
                </span>
              </a>
              <a href="">
                <i class="fa fa-envelope" aria-hidden="true"></i>
                <span>
                  pkbnic@yonsei.ac.kr
                </span>
              </a>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-lg-3 info_col">
      </div>
    </div>
  </section>

  <!-- end info section -->

<div style="padding : 15px 15px;"></div>

  <section>
    <center>
      <p>사전예약을 하시려면 이메일을 남겨주세요.</p>
      <input id="submit-email" type="email" placeholder="알림을 받으실 이메일" /> <br><br>
      <p>문의사항이나 피드백이 있으면 남겨주세요.</p>
      <textarea id="submit-advice" name="Text1" cols="40" rows="5" placeholder="문의사항, 피드백"></textarea><br>
      <button style="width:350px;" id="submit">지금 제출! </button>
        </center>
  </section>
  <div style="padding : 15px 15px;"></div>


  <!-- popper js -->
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <!-- bootstrap js -->
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <!-- owl slider -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <!-- custom js -->
  <script type="text/javascript" src="js/custom.js"></script>
  <!-- Google Map -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap"></script>
  <!-- End Google Map -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.js"></script>
  <link href="https://cdn.jsdelivr.net/gh/dinoqqq/simple-popup@master/dist/jquery.simple-popup.min.css" rel="stylesheet" type="text/css" />

  <div id="popup" style="display:none;">
    <h1>감사합니다. </h1>
    <p>출시되면 이메일을 드리겠습니다. </p>
      </div>

</body>

    <script type="application/javascript">
					var ip = "null";
					function getIP(json) {
					    console.log(json);
					    try {
							ip = json.ip;
					    } catch (e) {
							ip = 'unknown';
					    }
					    return;
					}
					</script>
					<script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>

  <script>
// Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
				function padValue(value) {
					return (value < 10) ? "0" + value : value;
				}

				function getTimeStamp() {
					const date = new Date();

					const year = date.getFullYear();
					const month = date.getMonth() + 1;
					const day = date.getDate();
					const hours = date.getHours();
					const minutes = date.getMinutes();
					const seconds = date.getSeconds();

					const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

					return formattedDate;
				}

  </script>

  <script>
    // 쿠키에서 값을 가져오는 함수
    function getCookieValue(name) {
					const value = "; " + document.cookie;
					const parts = value.split("; " + name + "=");
					if (parts.length === 2) {
						return parts.pop().split(";").shift();
					}
				}

				// 쿠키에 값을 저장하는 함수
				function setCookieValue(name, value, days) {
					let expires = "";
					if (days) {
						const date = new Date();
						date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
						expires = "; expires=" + date.toUTCString();
					}
					document.cookie = name + "=" + (value || "") + expires + "; path=/";
				}

				function getUVfromCookie() {
					// 6자리 임의의 문자열 생성
					const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
					// 쿠키에서 기존 해시 값을 가져옴
					const existingHash = getCookieValue("user");
					// 기존 해시 값이 없으면, 새로운 해시 값을 쿠키에 저장
					if (!existingHash) {
						setCookieValue("user", hash, 180); // 쿠키 만료일은 6개월 
						return hash;
					} else {
						// 기존 해시 값이 있으면, 기존 값을 반환
						return existingHash;
					}
				}
  </script>
  
  <script>
    var queryString = location.search;
				const urlParams = new URLSearchParams(queryString);
				const utm = urlParams.get("utm")

    var mobile = 'desktop';
				if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
					// true for mobile device
					mobile = 'mobile';
				}

    /* data를 만들 땐 모든 field가 들어 있어야 함 */
    var data = JSON.stringify(
					    {"id":getUVfromCookie(),
							"landingUrl":window.location.href, 
							"ip":ip, 
							"referer":document.referrer,
							"time_stamp":getTimeStamp(), 
							"utm":utm,
							"device":mobile}
							);

				$(document).ready(function () {

					addrScript = 'https://script.google.com/macros/s/AKfycbwFqGvrSN-_wVBGnFx8tDX8AvTXV1kC58oSqbUK1seZDXs2uoV8Ha3mhGENIxJtSsik/exec';

					axios.get(addrScript+'?action=insert&table=visitors&data='+data)
				    .then(response => {
							console.log(JSON.stringify(response));
						})
						.catch(error => {
							if (error.response) {
								// 서버가 2xx 범위를 벗어난 상태 코드로 응답한 경우
								console.log(error.response.data);
								console.log(error.response.status);
								console.log(error.response.headers);
							} else if (error.request) {
								// 요청이 전송되었지만 응답을 받지 못한 경우
								console.log(error.request);
							} else {
								// 요청 설정 중에 오류가 발생한 경우
								console.log('Error', error.message);
							}
							console.log(error.config);
						});

            $("#submit").on("click", function () {
            $.busyLoadFull("show");
					const email = $("#submit-email").val();
					const advice = $("#submit-advice").val();
		    
					function validateEmail(email) {
					    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
					    return re.test(email);
					}
		    
					if (email == '' || !validateEmail(email)) {
					    alert("이메일이 유효하지 않아 알림을 드릴 수가 없습니다. ");
					    return;
					}
		    
					var finalData = JSON.stringify({
					    "id": getUVfromCookie(),
					    "email": email,
					    "advice": advice
					})
		    
					axios.get( addrScript +'?action=insert&table=tab_final&data=' + finalData)
					    .then(response => {
						console.log(response.data.data);
            $.busyLoadFull("hide");
            $.fn.simplePopup({ type: "html", htmlSelector: "#popup" });
						//alert(JSON.stringify(response));
						$('#submit-email').val('');
						$('#submit-advice').val('');
					    })
				    });
				    });
  </script>

  <script>
    $(document).ready(function() {
      let currentDate = new Date();
      let selectedDate = null;
      let todos = [
        { title: '알고리즘 문제 풀이', dueDate: '2025-06-30', priority: 'very-high', duration: '180', description: '백준 10문제 풀이' },
        { title: '운영체제 프로젝트 구현', dueDate: '2025-06-25', priority: 'very-high', duration: '240', description: '메모리 관리 모듈 완성' },
        { title: '데이터베이스 스터디', dueDate: '2025-07-01', priority: 'high', duration: '120', description: 'SQLD 자격증 대비' },
        { title: '캡스톤 디자인 보고서 작성', dueDate: '2025-07-03', priority: 'high', duration: '300', description: '최종 보고서 초안 마무리' },
        { title: '인공지능 논문 읽기', dueDate: '2025-06-20', priority: 'medium', duration: '90', description: '최신 AI 동향 파악' },
        { title: '네트워크 보안 강의 복습', dueDate: '2025-06-15', priority: 'medium', duration: '60', description: 'OSI 7계층 다시 보기' },
        { title: '취업 박람회 참여', dueDate: '2025-06-10', priority: 'low', duration: '120', description: 'IT 기업 부스 방문' },
        { title: '체육 수업 (코딩)', dueDate: '2025-06-05', priority: 'low', duration: '60', description: '클라이밍 동아리 활동' },
        { title: '도서관 책 반납', dueDate: '2025-06-07', priority: 'very-low', duration: '30', description: '빌렸던 전공 서적' },
        { title: '팀 빌딩 회식', dueDate: '2025-06-12', priority: 'very-low', duration: '180', description: '새로운 팀원 환영회' }
      ];

      let events = {
        '2025-06-01': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-02': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' }
        ],
        '2025-06-03': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-04': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' }
        ],
        '2025-06-05': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-06': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' }
        ],
        '2025-06-07': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-08': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' }
        ],
        '2025-06-09': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-10': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-11': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-12': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-13': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-14': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' }
        ],
        '2025-06-15': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-16': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' }
        ],
        '2025-06-17': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-18': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-19': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-20': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-21': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-22': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' }
        ],
        '2025-06-23': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-24': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-25': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '과제 마감', startTime: '23:00', endTime: '23:59', description: '과제 마감 상세 내용', type: 'user' }
        ],
        '2025-06-26': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-27': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-06-28': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' }
        ],
        '2025-06-29': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-06-30': [
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-07-01': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '온라인 강의 수강', startTime: '11:00', endTime: '13:00', description: '온라인 강의 수강 상세 내용', type: 'user' },
          { title: '개인 프로젝트 코딩', startTime: '16:00', endTime: '18:00', description: '개인 프로젝트 코딩 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ],
        '2025-07-02': [
          { title: '전공 수업 A', startTime: '10:00', endTime: '12:00', description: '전공 수업 A 상세 내용', type: 'user' },
          { title: '운동', startTime: '18:00', endTime: '19:00', description: '운동 상세 내용', type: 'user' },
          { title: '팀 회의', startTime: '14:00', endTime: '15:00', description: '팀 회의 상세 내용', type: 'user' }
        ],
        '2025-07-03': [
          { title: '알고리즘 스터디', startTime: '09:00', endTime: '11:00', description: '알고리즘 스터디 상세 내용', type: 'user' },
          { title: '전공 수업 B', startTime: '13:00', endTime: '15:00', description: '전공 수업 B 상세 내용', type: 'user' },
          { title: '도서관 자습', startTime: '19:00', endTime: '21:00', description: '도서관 자습 상세 내용', type: 'user' }
        ]
      };

      // 선택된 날짜의 일정을 오른쪽 패널에 렌더링하는 함수
      function renderEventsForSelectedDate(date) {
        selectedDate = date;
        $('#selectedDateEventsTitle').text(`${date}`);
        const dayEvents = events[date] || [];
        
        // 시간순으로 일정 정렬
        dayEvents.sort((a, b) => a.startTime.localeCompare(b.startTime));

        let eventListHTML = '';
        if (dayEvents.length === 0) {
          eventListHTML = '<p class="text-center text-muted mt-4">이 날짜에는 일정이 없습니다.</p>';
        } else {
          dayEvents.forEach(event => {
            // type이 'ai'인 경우 다른 스타일 적용 가능
            const eventClass = event.type === 'ai' ? 'event-ai-scheduled' : ''; 
            eventListHTML += `
              <div class="event ${eventClass}">
                <div class="event-title">${event.title}</div>
                <div class="event-time">${event.startTime} - ${event.endTime}</div>
                <div class="event-description">${event.description || ''}</div>
                <div class="event-buttons">
                  <button class="btn btn-primary btn-sm edit-event-btn" data-date="${date}" data-title="${event.title}">수정</button>
                  <button class="btn btn-danger btn-sm delete-event-btn" data-date="${date}" data-title="${event.title}">삭제</button>
                </div>
              </div>
            `;
          });
        }
        $('#currentDayEvents').html(eventListHTML);
      }

      // 할 일 목록 렌더링 함수
      function renderTodoList() {
        let todoListHTML = '';
        // 스케줄링되지 않은 할 일만 표시 (스케줄링된 할 일은 events로 이동)
        // const unscheduledTodos = todos.filter(todo => !todo.scheduled);

        // 모든 할 일을 표시하되, 스케줄링된 할 일은 배치 정보를 함께 표시
        if (todos.length === 0) {
          todoListHTML = '<p class="text-center text-muted mt-4">할 일이 없습니다.</p>';
        } else {
          todos.forEach((todo, index) => {
            const scheduledInfo = todo.scheduled ? `<div class="scheduled-info">배치됨: ${todo.scheduledDate} ${todo.scheduledStartTime}-${todo.scheduledEndTime}</div>` : '';
            todoListHTML += `
              <div class="todo-item ${todo.priority}-priority">
                <div class="todo-title">${todo.title}</div>
                <div class="todo-details">
                  <span class="todo-due-date">마감: ${todo.dueDate}</span>
                  <span class="todo-duration"> | 예상 소요 시간: ${todo.duration}분</span>
                </div>
                ${scheduledInfo}
                <div class="todo-description">${todo.description || ''}</div>
                <div class="todo-buttons">
                  <button class="btn btn-primary btn-sm edit-todo-btn" data-index="${index}">수정</button>
                  <button class="btn btn-danger btn-sm delete-todo-btn" data-index="${index}">삭제</button>
                </div>
              </div>
            `;
          });
        }
        $('#todoList').html(todoListHTML);
      }

      function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        $('#currentMonth').text(`${year}년 ${month + 1}월`);
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        let calendarHTML = '';
        
        // 이전 달의 날짜들
        const firstDayOfWeek = firstDay.getDay();
        for (let i = 0; i < firstDayOfWeek; i++) {
          const prevDate = new Date(year, month, -i);
          calendarHTML += `<div class="calendar-day other-month" data-date="${prevDate.toISOString().split('T')[0]}">
            <div class="day-number">${prevDate.getDate()}</div>
          </div>`;
        }
        
        // 현재 달의 날짜들
        for (let date = 1; date <= lastDay.getDate(); date++) {
          const currentDateObj = new Date(year, month, date);
          const currentDateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
          const dayEvents = events[currentDateStr] || [];
          
          let todayClass = '';
          const today = new Date();
          if (currentDateObj.toDateString() === today.toDateString()) {
            todayClass = 'today';
            if (selectedDate === null) {
              selectedDate = currentDateStr;
            }
          }

          let selectedClass = '';
          if (currentDateStr === selectedDate) {
            selectedClass = 'selected';
          }
          
          calendarHTML += `<div class="calendar-day ${todayClass} ${selectedClass}" data-date="${currentDateStr}">
            <div class="day-number">${date}</div>
            ${dayEvents.map(event => `
              <div class="event">
                ${event.title}
              </div>
            `).join('')}
          </div>`;
        }
        
        // 다음 달의 날짜들
        const remainingDays = 42 - (firstDayOfWeek + lastDay.getDate());
        for (let i = 1; i <= remainingDays; i++) {
          const nextDate = new Date(year, month + 1, i);
          calendarHTML += `<div class="calendar-day other-month" data-date="${nextDate.toISOString().split('T')[0]}">
            <div class="day-number">${nextDate.getDate()}</div>
          </div>`;
        }
        
        $('#calendarGrid').html(calendarHTML);

        if (selectedDate) {
          renderEventsForSelectedDate(selectedDate);
        }
      }

      // 달력 초기 렌더링
      renderCalendar();

      // 이전/다음 달 버튼 이벤트
      $('#prevMonth').click(function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        selectedDate = null;
        renderCalendar();
      });

      $('#nextMonth').click(function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        selectedDate = null;
        renderCalendar();
      });

      // 날짜 클릭 시 일정 목록 표시 및 선택 표시
      $(document).on('click', '.calendar-day', function() {
        $('.calendar-day').removeClass('selected');
        $(this).addClass('selected');
        const date = $(this).data('date');
        renderEventsForSelectedDate(date);
      });

      // 일정 삭제 기능
      $(document).on('click', '.delete-event-btn', function() {
        const dateToDelete = $(this).data('date');
        const titleToDelete = $(this).data('title');

        if (confirm(`'${titleToDelete}' 일정을 삭제하시겠습니까?`)) {
          events[dateToDelete] = events[dateToDelete].filter(event => event.title !== titleToDelete);
          if (events[dateToDelete].length === 0) {
            delete events[dateToDelete];
          }
          renderCalendar();
          renderEventsForSelectedDate(selectedDate);
        }
      });

      // 새 일정 추가 버튼 클릭
      $('#addNewEventBtn').click(function() {
        if (selectedDate) {
          $('#eventDate').val(selectedDate);
        } else {
          const today = new Date();
          const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
          $('#eventDate').val(todayStr);
        }
        $('#addEventModal').modal('show');
      });

      // 일정 폼 제출
      $('#eventForm').submit(function(e) {
        e.preventDefault();
        
        const startHour = $('#eventStartHour').val();
        const startMinute = $('#eventStartMinute').val();
        const endHour = $('#eventEndHour').val();
        const endMinute = $('#eventEndMinute').val();

        const newEvent = {
          title: $('#eventTitle').val(),
          startTime: `${startHour}:${startMinute}`,
          endTime: `${endHour}:${endMinute}`,
          description: $('#eventDescription').val(),
          type: 'user' // 사용자 추가 이벤트는 'user' 타입으로 설정
        };
        
        const date = $('#eventDate').val();
        if (!events[date]) {
          events[date] = [];
        }
        events[date].push(newEvent);
        
        $('#addEventModal').modal('hide');
        // rebalanceSchedule(); // 일정 추가 후 리밸런싱 호출 (자동 호출 제거)
        
        this.reset();
      });

      // 새 할 일 추가 버튼 클릭
      $('#addNewTodoBtn').click(function() {
        $('#addTodoModal').modal('show');
      });

      // '리밸런싱' 버튼 클릭 이벤트
      $('#rebalanceScheduleBtn').click(function() {
        rebalanceSchedule();
      });

      // 할 일 폼 제출
      $('#todoForm').submit(function(e) {
        e.preventDefault();
        
        const newTodo = {
          title: $('#todoTitle').val(),
          dueDate: $('#todoDueDate').val(),
          priority: $('#todoPriority').val(),
          duration: $('#todoDuration').val(),
          description: $('#todoDescription').val(),
          scheduled: false // 초기에는 스케줄링되지 않음
        };
        
        todos.push(newTodo);
        
        $('#addTodoModal').modal('hide');
        renderTodoList(); // 할 일 추가 후 목록 바로 업데이트
        // rebalanceSchedule(); // 할 일 추가 후 리밸런싱 호출 (자동 호출 제거)
        
        this.reset();
      });

      // 할 일 삭제
      $(document).on('click', '.delete-todo-btn', function() {
        const index = $(this).data('index');
        const todoToDelete = todos[index];

        if (confirm(`'${todoToDelete.title}' 할 일을 삭제하시겠습니까?`)) {
          // 해당 할 일이 스케줄링되어 있었다면, 캘린더에서도 제거
          if (todoToDelete.scheduled) {
            for (const date in events) {
              events[date] = events[date].filter(event => {
                // AI가 스케줄링한 이벤트이고, 해당 todo의 인덱스와 일치하는 경우
                return !(event.type === 'ai' && event.originalTodoIndex === index);
              });
              if (events[date].length === 0) {
                delete events[date];
              }
            }
          }
          todos.splice(index, 1);
          renderTodoList(); // 할 일 삭제 후 목록 바로 업데이트
          renderCalendar(); // 캘린더도 다시 그리기 (스케줄링된 할 일 삭제로 인해)
        }
      });

      // 초기 할 일 목록 렌더링
      renderTodoList();

      // 페이지 로드 시 스케줄 리밸런싱 자동 호출
      rebalanceSchedule();

      // 스케줄 리밸런싱 함수
      function rebalanceSchedule() {
        console.log("스케줄 리밸런싱이 호출되었습니다.");

        // 모든 할 일의 스케줄링 상태 초기화 (재배치를 위해)
        todos.forEach(todo => {
          todo.scheduled = false;
          todo.scheduledDate = null;
          todo.scheduledStartTime = null;
          todo.scheduledEndTime = null;
        });

        // 1. 이전에 AI가 스케줄링했던 모든 일정을 제거
        for (const date in events) {
          events[date] = events[date].filter(event => event.type !== 'ai');
          if (events[date].length === 0) {
            delete events[date];
          }
        }

        // 2. todos를 우선순위 및 마감 기한으로 정렬
        todos.sort((a, b) => {
          const priorityOrder = { 'very-high': 5, 'high': 4, 'medium': 3, 'low': 2, 'very-low': 1 };
          if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
            return priorityOrder[b.priority] - priorityOrder[a.priority]; // 높은 우선순위가 먼저 오도록
          }
          return new Date(a.dueDate) - new Date(b.dueDate); // 마감 기한이 빠른 것이 먼저 오도록
        });

        // 3. 자유 시간 슬롯 계산 및 todos 할당
        const today = new Date();
        const planningHorizonDays = 60; // 예를 들어, 앞으로 60일 동안의 일정을 계획

        for (let i = 0; i < planningHorizonDays; i++) {
          const currentDay = new Date(today);
          currentDay.setDate(today.getDate() + i);
          const currentDayStr = `${currentDay.getFullYear()}-${String(currentDay.getMonth() + 1).padStart(2, '0')}-${String(currentDay.getDate()).padStart(2, '0')}`;

          // 해당 날짜의 사용자 생성 이벤트를 가져옴
          const userEventsToday = (events[currentDayStr] || []).filter(event => event.type === 'user');

          // 하루 전체를 자유 시간으로 초기화 (08:00 ~ 24:00)
          let freeSlots = [{ start: '08:00', end: '24:00' }];

          // 사용자 생성 이벤트를 고려하여 자유 시간 슬롯 조정
          userEventsToday.forEach(event => {
            const eventStart = event.startTime;
            const eventEnd = event.endTime;

            let newFreeSlots = [];
            freeSlots.forEach(slot => {
              const slotStart = slot.start;
              const slotEnd = slot.end;

              if (eventStart >= slotEnd || eventEnd <= slotStart) {
                newFreeSlots.push(slot);
              } else {
                if (slotStart < eventStart) {
                  newFreeSlots.push({ start: slotStart, end: eventStart });
                }
                if (slotEnd > eventEnd) {
                  newFreeSlots.push({ start: eventEnd, end: slotEnd });
                }
              }
            });
            freeSlots = newFreeSlots.sort((a, b) => a.start.localeCompare(b.start));
          });

          // 현재 날짜가 오늘인 경우, 현재 시간 이전의 슬롯은 무시
          if (currentDayStr === `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`) {
            const currentHour = String(today.getHours()).padStart(2, '0');
            const currentMinute = String(today.getMinutes()).padStart(2, '0');
            const currentTime = `${currentHour}:${currentMinute}`;
            freeSlots = freeSlots.filter(slot => slot.end > currentTime);
            freeSlots = freeSlots.map(slot => {
                if (slot.start < currentTime) {
                    return { start: currentTime, end: slot.end };
                } else {
                    return slot;
                }
            });
          }
          
          // 유효한 자유 시간 슬롯에 할 일 할당 시도
          for (let j = 0; j < todos.length; j++) {
            const todo = todos[j];
            if (todo.scheduled) continue; // 이미 스케줄링된 할 일은 건너뛰기

            const todoDuration = parseInt(todo.duration); // 할 일 소요 시간 (분)
            const todoDueDate = new Date(todo.dueDate); // 할 일 마감 기한

            // 마감 기한이 지난 할 일은 스케줄링하지 않음
            if (currentDay > todoDueDate) continue;

            for (let k = 0; k < freeSlots.length; k++) {
              const slot = freeSlots[k];
              const [slotStartHour, slotStartMinute] = slot.start.split(':').map(Number);
              const [slotEndHour, slotEndMinute] = slot.end.split(':').map(Number);

              const slotStartTime = slotStartHour * 60 + slotStartMinute;
              const slotEndTime = slotEndHour * 60 + slotEndMinute;
              const slotDuration = slotEndTime - slotStartTime; // 슬롯의 총 시간 (분)

              if (slotDuration >= todoDuration) {
                // 할 일을 이 슬롯에 스케줄링
                const scheduledStartTime = slot.start;
                const scheduledEndTime = `${String(Math.floor((slotStartTime + todoDuration) / 60)).padStart(2, '0')}:${String((slotStartTime + todoDuration) % 60).padStart(2, '0')}`;

                const scheduledEvent = {
                  title: todo.title,
                  startTime: scheduledStartTime,
                  endTime: scheduledEndTime,
                  description: todo.description,
                  type: 'ai', // AI 스케줄링된 이벤트
                  originalTodoIndex: j // 원본 todo의 인덱스 (삭제 시 사용)
                };

                if (!events[currentDayStr]) {
                  events[currentDayStr] = [];
                }
                events[currentDayStr].push(scheduledEvent);
                
                // 스케줄링된 할 일은 todos 배열에서 제거 (또는 scheduled 플래그 설정)
                todo.scheduled = true; // 이 할 일은 이제 스케줄링됨
                todo.scheduledDate = currentDayStr; // 스케줄링된 날짜 기록
                todo.scheduledStartTime = scheduledStartTime; // 스케줄링된 시작 시간 기록
                todo.scheduledEndTime = scheduledEndTime; // 스케줄링된 종료 시간 기록

                // 해당 슬롯 업데이트 (남은 시간만큼 줄임)
                const remainingSlotStart = scheduledEndTime;
                freeSlots.splice(k, 1, { start: remainingSlotStart, end: slot.end });
                
                // 다음 할 일을 위해 내부 루프 중단
                break; 
              }
            }
          }
        }

        renderCalendar(); // 캘린더 다시 그리기
        renderTodoList(); // 할 일 목록 다시 그리기
      }

      // 일정 수정 버튼 클릭
      $(document).on('click', '.edit-event-btn', function() {
        const dateToEdit = $(this).data('date');
        const titleToEdit = $(this).data('title');
        const eventToEdit = events[dateToEdit].find(event => event.title === titleToEdit);
        
        // 모달 폼에 기존 데이터 채우기
        $('#eventTitle').val(eventToEdit.title);
        $('#eventDate').val(dateToEdit);
        
        // 시작 시간 설정
        const [startHour, startMinute] = eventToEdit.startTime.split(':');
        $('#eventStartHour').val(startHour);
        $('#eventStartMinute').val(startMinute);
        $('#eventStartAmPm').val(parseInt(startHour) >= 12 ? 'PM' : 'AM');
        
        // 종료 시간 설정
        const [endHour, endMinute] = eventToEdit.endTime.split(':');
        $('#eventEndHour').val(endHour);
        $('#eventEndMinute').val(endMinute);
        $('#eventEndAmPm').val(parseInt(endHour) >= 12 ? 'PM' : 'AM');
        
        $('#eventDescription').val(eventToEdit.description);
        
        // 기존 이벤트 삭제
        events[dateToEdit] = events[dateToEdit].filter(event => event.title !== titleToEdit);
        if (events[dateToEdit].length === 0) {
          delete events[dateToEdit];
        }
        
        $('#addEventModal').modal('show');
      });

      // 할 일 수정 버튼 클릭
      $(document).on('click', '.edit-todo-btn', function() {
        const index = $(this).data('index');
        const todoToEdit = todos[index];
        
        // 모달 폼에 기존 데이터 채우기
        $('#todoTitle').val(todoToEdit.title);
        $('#todoDueDate').val(todoToEdit.dueDate);
        $('#todoPriority').val(todoToEdit.priority);
        $('#todoDuration').val(todoToEdit.duration);
        $('#todoDescription').val(todoToEdit.description);
        
        // 기존 할 일 삭제
        todos.splice(index, 1);
        
        $('#addTodoModal').modal('show');
      });

    });
  </script>

</html>
